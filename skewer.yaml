title: Skupper Hello World using Podman
subtitle: Connect services running as Podman containers
workflow: null
overview: |
  This example is a basic multi-service HTTP application deployed
  across a Kubernetes cluster and a bare-metal host or VM running
  Podman containers.

  It contains two services:

  * A backend service that exposes an `/api/hello` endpoint.  It
    returns greetings of the form `Hi, <your-name>.  I am <my-name>
    (<container>)`.

  * A frontend service that sends greetings to the backend and
    fetches new greetings in response.

  With Skupper, you can run the backend as a container on your local
  machine and the frontend in Kubernetes and maintain connectivity
  between the two services without exposing the backend to the public
  internet.

  <!-- <img src="images/entities.svg" width="640"/> -->
prerequisites: |
  * A working installation of Podman ([installation
    guide][install-podman])

  * The `kubectl` command-line tool, version 1.15 or later
    ([installation guide][install-kubectl])

  * Access to a Kubernetes cluster, from [any provider you
    choose][kube-providers]

  [install-podman]: https://podman.io/getting-started/installation
  [install-kubectl]: https://kubernetes.io/docs/tasks/tools/install-kubectl/
  [kube-providers]: https://skupper.io/start/kubernetes.html
sites:
  kubernetes:
    title: Kubernetes
    platform: kubernetes
    namespace: west
    env:
      KUBECONFIG: ~/.kube/config-west
  podman:
    title: Podman
    platform: podman
    namespace: east
    env:
      SKUPPER_PLATFORM: podman
steps:
  - standard: platform/set_up_your_kubernetes_cluster
  - title: Set up your Podman environment
    preamble: |
      Open a new terminal window and set the `SKUPPER_PLATFORM`
      environment variable to `podman`.  This sets the Skupper platform
      to Podman for this terminal session.

      Use `systemctl` to enable the Podman API service.
    commands:
      podman:
        - run: export SKUPPER_PLATFORM=podman
  - title: Deploy the frontend and backend
    preamble: |
      This example runs the frontend in Kubernetes and the backend as
      a local Podman container.

      In Kubernetes, use `kubectl create deployment` to deploy the
      frontend service in namespace `west`.

      In Podman, use `podman run` to start the backend service on your
      local machine.
    commands:
      kubernetes:
        - run: kubectl create deployment frontend --image quay.io/skupper/hello-world-frontend
      podman:
        - run: podman run --name backend --detach --rm -p 9090:8080 quay.io/skupper/hello-world-backend
  - standard: platform/install_the_skupper_command_line_tool
  - standard: platform/install_skupper_on_your_kubernetes_cluster
  - title: Install Skupper in your Podman environment
    commands:
      podman:
        - run: |
            # Current:
            systemctl --user enable --now podman.socket
            # Want:
            # skupper system install
            # skupper system start
  - title: Create your sites
    preamble: |
      A Skupper _site_ is a location where your application workloads
      are running.  Sites are linked together to form a network for your
      application.

      For each namespace, use `skupper site create` with a site name of
      your choice.  This creates the site resource and deploys the
      Skupper router to the namespace.

      **Note:** If you are using Minikube, you need to [start minikube
      tunnel][minikube-tunnel] before you run `skupper site create`.

      <!-- XXX Explain enabling link acesss on one of the sites -->

      [minikube-tunnel]: https://skupper.io/start/minikube.html#running-minikube-tunnel
    commands:
      kubernetes:
        - run: skupper site create west --enable-link-access --timeout 2m
          output: |
            Waiting for status...
            Site "west" is configured. Check the status to see when it is ready
      podman:
        - run: skupper site create east
        - run: |
            # Current:
            skupper system setup
            # Want:
            # skupper system reload
  - title: Link your sites
    preamble: |
      A Skupper _link_ is a channel for communication between two sites.
      Links serve as a transport for application connections and
      requests.
    commands:
      kubernetes:
        - run: |
            # Current:
            skupper link generate > link.yaml
            # Want:
            # skupper token issue ~/secret.token
      podman:
        - run: |
            # Current:
            mv link.yaml /home/jross/.local/share/skupper/namespaces/default/input/resources/link.yaml
            # Want:
            # skupper token redeem ~/secret.token
        - run: skupper system reload
  - standard: hello_world/expose_the_backend_service/kubernetes_cli
    commands:
      kubernetes:
        - run: skupper listener create backend 8080
      podman:
        - run: |
            # Current:
            skupper connector create backend 9090 --host localhost
            # Want:
            # skupper connector create backend 9090
        - run: skupper system reload
    postamble: |
      The commands shown above use the name argument, `backend`, to
      also set the default routing key.  You can use the
      `--routing-key` option to specify another value.
  - standard: hello_world/access_the_frontend_service/kubernetes_cli
  - standard: skupper/cleaning_up/kubernetes_cli
    commands:
      kubernetes:
        - run: skupper site delete --all
      podman:
        - run: skupper site delete --all
        - run: podman rm -f backend
