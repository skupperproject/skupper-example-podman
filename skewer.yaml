title: Skupper Hello World using Podman
subtitle: Connect services running as Podman containers
workflow: null
overview: |
  This example is a basic multi-service HTTP application deployed
  across a Kubernetes cluster and a bare-metal host or VM running
  Podman containers.

  It contains two services:

  * A backend service that exposes an `/api/hello` endpoint.  It
    returns greetings of the form `Hi, <your-name>.  I am <my-name>
    (<container>)`.

  * A frontend service that sends greetings to the backend and
    fetches new greetings in response.

  With Skupper, you can run the backend as a container on your local
  machine and the frontend in Kubernetes and maintain connectivity
  between the two services without exposing the backend to the public
  internet.

  <!-- <img src="images/entities.svg" width="640"/> -->
prerequisites: |
  * A working installation of Podman ([installation
    guide][install-podman])

  * The `kubectl` command-line tool, version 1.15 or later
    ([installation guide][install-kubectl])

  * Access to a Kubernetes cluster, from [any provider you
    choose][kube-providers]

  [install-podman]: https://podman.io/getting-started/installation
  [install-kubectl]: https://kubernetes.io/docs/tasks/tools/install-kubectl/
  [kube-providers]: https://skupper.io/start/kubernetes.html
sites:
  kubernetes:
    title: Kubernetes
    platform: kubernetes
    namespace: west
    env:
      KUBECONFIG: ~/.kube/config-west
  podman:
    title: Podman
    platform: podman
    namespace: east
    env:
      SKUPPER_PLATFORM: podman
steps:
  - standard: kubernetes/set_up_your_kubernetes_cluster
  - standard: podman/set_up_your_podman_environment
  - standard: kubernetes/install_skupper_on_your_clusters
  - title: Deploy the frontend and backend
    preamble: |
      This example runs the frontend in Kubernetes and the backend as
      a local Podman container.

      In Kubernetes, use `kubectl create deployment` to deploy the
      frontend service in namespace `west`.

      In Podman, use `podman run` to start the backend service on your
      local machine.
    commands:
      kubernetes:
        - run: kubectl create deployment frontend --image quay.io/skupper/hello-world-frontend
      podman:
        - run: podman run --name backend --detach --rm -p 9090:8080 quay.io/skupper/hello-world-backend
  - title: Create your sites
    preamble: |
      A Skupper _site_ is a location where components of your
      application are running.  Sites are linked together to form a
      Skupper network for your application.

      In Kubernetes, use `skupper site create` with a site name of
      your choice.  This creates the site resource and deploys the
      Skupper router to the namespace.

      XXX In Podman, use `skupper init` with the option `--ingress none`
      and use `skupper status` to see the result. XXX

      **Note:** If you are using Minikube, you need to [start minikube
      tunnel][minikube-tunnel] before you run `skupper init`.

      <!-- XXX Explain enabling link acesss on one of the sites -->

      [minikube-tunnel]: https://skupper.io/start/minikube.html#running-minikube-tunnel
    commands:
      kubernetes:
        - run: skupper site create west --enable-link-access
          output: |
            Waiting for status...
            Site "west" is configured. Check the status to see when it is ready
        - run: |
           kubectl wait --for condition=Ready site/west --timeout=60s # Required with preview 1 - to be removed!
          output: |
            site.skupper.io/west condition met
      podman:
        - run: curl https://raw.githubusercontent.com/skupperproject/skupper/refs/heads/v2/cmd/bootstrap/bootstrap.sh | SKUPPER_PLATFORM=podman sh -s -- -p east -f
          output: |
            XXX
    postamble: |
      You can use `skupper site status` at any time to check the status
      of your site.
  - title: Sleep!
    commands:
      kubernetes:
        - run: sleep 10
        - run: kubectl get pods
        - run: podman ps
        - run: sleep 86400
  - title: Cleaning up
    name: cleaning_up
    numbered: false
    preamble: |
      To remove Skupper and the other resources from this exercise, use
      the following commands:
    commands:
      podman:
        - run: curl https://raw.githubusercontent.com/skupperproject/skupper/refs/heads/v2/cmd/bootstrap/remove.sh | sh
        - run: podman rm -f backend

  # - standard: hello_world/access_the_frontend
  # - standard: general/cleaning_up
